# MitraAI - Production Health Check
# Monitors production endpoints every 5 minutes

name: Production Health Check

on:
  schedule:
    - cron: '*/5 * * * *' # Every 5 minutes
  workflow_dispatch:

jobs:
  health-check:
    name: üè• Health Check
    runs-on: ubuntu-latest
    
    steps:
      - name: Check Frontend (Vercel)
        run: |
          STATUS=$(curl -s -o /dev/null -w "%{http_code}" https://mitra-ai-rho.vercel.app/)
          if [ $STATUS -eq 200 ]; then
            echo "‚úÖ Frontend is healthy (Status: $STATUS)"
          else
            echo "‚ùå Frontend is down (Status: $STATUS)"
            exit 1
          fi

      - name: Check Backend (Render)
        run: |
          STATUS=$(curl -s -o /dev/null -w "%{http_code}" https://mitraai-backend.onrender.com/health)
          if [ $STATUS -eq 200 ]; then
            echo "‚úÖ Backend is healthy (Status: $STATUS)"
          else
            echo "‚ùå Backend is down (Status: $STATUS)"
            exit 1
          fi

      - name: Create Issue if Down
        if: failure()
        uses: actions/github-script@v7
        with:
          script: |
            github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: 'üö® Production Service Down - ' + new Date().toISOString(),
              body: '## Health Check Failed\n\n' +
                    'One or more services are not responding.\n\n' +
                    '- Frontend: https://mitra-ai-rho.vercel.app/\n' +
                    '- Backend: https://mitraai-backend.onrender.com/health\n\n' +
                    'Please investigate immediately.',
              labels: ['production', 'critical']
            })
